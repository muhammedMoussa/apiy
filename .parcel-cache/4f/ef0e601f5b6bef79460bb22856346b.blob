"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Get = void 0;

var _utils = require("../../utils");

/* get function */
const Get = options => {
  const req = new Promise(async (resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json'; // xhr.withCredentials = true;
    // @TODO: UTIL THIS TO READ FROM options

    xhr.setRequestHeader('Content-Type', 'application/json'); // @TODO: WRAP IN trycatch

    await xhr.open(options.method, options.url);
    await xhr.send();

    xhr.onload = async () => await (0, _utils.onloadHandler)(req, xhr);

    xhr.onprogress = event => {
      /* @TODO: HANDLE FOR DOWNLOAD CASES. */
    };

    xhr.onreadystatechange = () => {
      // @TODO: UtIL WITH RXJS
      if (xhr.readyState == 3 || xhr.readyState == 1) {
        options.loading = true;
      }

      if (xhr.readyState == 4) {
        options.loading = false;
      }
    };

    xhr.onerror = () => reject(new Error("â›” Ooops!"));
  });
  return req;
};

exports.Get = Get;